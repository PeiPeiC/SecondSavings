<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/static/css/style.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.staticfile.org/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.staticfile.org/bootstrap-icons/1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
    {% block css %}
    {% endblock %}
</head>
<body>

<div class="container-fluid h-100">
  <div class="row h-100">
    <!-- 侧边栏导航 -->
    <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
        <a href="{% url 'TimeTracker:mian' %}">
            <!-- 主页房屋按钮 -->
            <i class="bi bi-house-door-fill" style="font-size: 35px"></i>
        </a>
        <div class="sidebar-sticky pt-3">
            <ul class="nav flex-column">
                <!-- 导航链接 -->
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'TimeTracker:profile' %}">
                        Account
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'report' %}">Report</a>
                </li>
                <li class="nav-item {% if request.path == '/Group/' %}active{% endif %}">
                    <a class="nav-link" href="{% url 'table' %}">Group</a>
                </li>
                <li class="nav-item {% if request.path == '/MusicList/' %}active{% endif %}">
                    <a class="nav-link" href="{% url 'music' %}">Music List</a>
                </li>
                <li class="nav-item {% if request.path == '/Coin/' %}active{% endif %}">
                    <a class="nav-link" href="{% url 'coin' %}">Coin</a>
                <li class="nav-item {% if request.path == '/Badges/' %}active{% endif %}">
                    <a class="nav-link" href="{% url 'badges' %}">Badges</a>
                </li>
                <li class="nav-item {% if request.path == '/Setting/' %}active{% endif %}">
                    <a class="nav-link" href="{% url 'setting' %}">Setting</a>
                </li>

            </ul>
        </div>
    </nav>
    <!-- 主内容区域 -->
    <main class="col-md-9 ml-sm-auto col-lg-10 px-md-4 py-4">
        <div class="user-info">
            <!-- 用户头像 -->
            <div class="user-icon text-center">
                {% if user_profile.avatar %}
                <img id="avatar" src="{{ user_profile.avatar }}" alt="avatar">
                {% else %}
                <i class="bi bi-person-circle" style="font-size: 70px"></i>
                {% endif %}
            </div>
            {% block content %}
            {% endblock %}
        </div>
    </main>
  </div>
</div>

<!-- 引入单独的JavaScript文件 -->



<!-- Bootstrap的JavaScript脚本 -->
<script src="https://cdn.staticfile.org/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

<script>
    // profile base 头像
let csrftoken = '{{ csrf_token }}'

document.addEventListener("DOMContentLoaded", function() {
    // 添加事件监听器到头像图标
    var avatarIcon = document.querySelector(".user-icon .bi-person-circle");
    if (avatarIcon) {
        avatarIcon.addEventListener("click", function() {
            // 触发图片编辑功能
            console.log("Edit Avatar");

            // 弹出文件选择框，让用户选择新头像图片文件
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(event) {
                var file = event.target.files[0];
                var reader = new FileReader();
                reader.onload = function(event) {
                    // 更新头像图标的样式
                    avatarIcon.style.backgroundImage = "url('" + event.target.result + "')";
                    // 设置提示文本
                    avatarIcon.title = "Click to Change Avatar";
                    // 可以在这里将新头像提交到服务器保存
                    submitAvatar(event.target.result);
                };
                reader.readAsDataURL(file);
            };
            input.click();
        });

        // 添加鼠标悬停提示
        avatarIcon.title = "Click to Edit Avatar";
    }
});

function submitAvatar(avatarData) {
    // 构建 HTTP 请求
    fetch('{% url 'TimeTracker:avatar_update' %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify({ avatarData }),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Avatar update successful:', data);
    })
    .catch(error => {
        console.error('Error updating avatar:', error);
    });
}

</script>

</body>
</html>
