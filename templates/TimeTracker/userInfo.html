<!-- profile默认页（account) -->
{% extends 'TimeTracker/base.html' %}
{% block css %}
    <link rel="stylesheet " href="/static/css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

{% endblock %}
{% block content %}
<form id="user_form" action="{% url 'TimeTracker:profile_update' user.username %}" method="post">
    <div class="user-field">
        <label for="name">Name</label>
        <input type="text" class="form-control" id="name" value={{ user_profile.nickName }} readonly>
    </div>
    <div class="user-field">
        <label for="email">Email</label>
        <input type="email" class="form-control" id="email" value={{ user.email }} readonly>
    </div>
    <button type="button" class="btn btn-secondary" onclick="enableFields()">Reset</button>
    <button type="button" class="btn btn-primary" id="submit-btn" style="display: none;" onclick="submitForm()">Submit</button>
</form>

<script>
function enableFields() {
    document.getElementById("name").readOnly = false;
    document.getElementById("email").readOnly = false;

    // 将“Reset”按钮变成可点击的提交按钮
    const resetButton = document.querySelector('.btn-secondary');
    resetButton.innerHTML = 'Cancel'; // 更改按钮文本
    resetButton.classList.remove('btn-secondary'); // 移除原按钮样式
    resetButton.classList.add('btn-primary'); // 添加提交按钮样式
    resetButton.setAttribute('onclick', 'cancelChanges()'); // 更改按钮点击行为

    // 显示提交按钮
    document.getElementById("submit-btn").style.display = 'inline-block';
}

function cancelChanges() {
    // 取消编辑状态，将字段设置为只读
    document.getElementById("name").readOnly = true;
    document.getElementById("email").readOnly = true;
    // 恢复“Reset”按钮状态
    const resetButton = document.querySelector('.btn-primary');
    resetButton.innerHTML = 'Reset';
    resetButton.classList.remove('btn-primary');
    resetButton.classList.add('btn-secondary');
    resetButton.setAttribute('onclick', 'enableFields()');
    // 隐藏提交按钮
    document.getElementById("submit-btn").style.display = 'none';
}

function submitForm() {
    // 提交的操作，可以通过JavaScript来实现
    {#document.getElementById("user_form").submit();#}
    // 构建包含表单数据的数据对象
    var formData = {
        nickName: $('#name').val(),
        email: $('#email').val(),
        // 添加其他字段...
    };

    // 发送POST请求到指定的URL
    $.post($("#user_form").attr("action"), formData, function(response) {
        // 处理响应，可以在这里进行重定向或其他操作
        console.log(response);
    });
}
</script>
{% endblock %}